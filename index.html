<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Talent Directory</title>
<style>
  body { font-family: Arial, sans-serif; background: #fdf8f0; margin: 0; padding: 0; color: #333; }
  header { background: linear-gradient(90deg, #004aad, #f5c518); color: #fff; padding: 20px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 15px; }
  header img { height: 50px; }
  .container { max-width: 900px; margin: 40px auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  input { width: 70%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-right: 10px; }
  button { padding: 10px 16px; background: #004aad; color: white; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; }
  button:hover { background: #003580; }
  .profile { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px; display: flex; gap: 20px; align-items: center; }
  .profile img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; }
  .profile-details { flex: 1; }
  .profile-details h3 { margin: 0; color: #004aad; }
  .skills, .tools { margin: 8px 0; }
  .actions a, .actions button { margin-right: 10px; text-decoration: none; display: inline-block; }
  .actions a.disabled { color: #aaa; pointer-events: none; }
</style>
</head>
<body>
<header>
  <img src="https://i.imgur.com/d2BCvGL.png" alt="Office Beacon Logo">
  <h1>Talent Directory</h1>
</header>

<div class="container">
  <h2>Search Profiles</h2>
  <input id="searchInput" placeholder="Enter name, skill, or tool...">
  <button onclick="searchProfiles()">Search</button>
  <button onclick="showAll()">View All</button>
  <div id="results"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyYHr23yFW26GokRPSo3WC9WehxMaKicEg7pzaLQLyMdbEXzsuVEvF3CLyPoVvyH_ZWjg/exec"; // replace with your Apps Script web app URL
let profiles = [];

function fetchProfiles() {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      profiles = data.data;
      showAll();
    })
    .catch(err => {
      console.error(err);
      document.getElementById("results").innerText = "Error loading profiles.";
    });
}

function searchProfiles() {
  const query = document.getElementById("searchInput").value.toLowerCase();
  const filtered = profiles.filter(p =>
    p["Name"].toLowerCase().includes(query) ||
    (p["Skills"] && p["Skills"].toLowerCase().includes(query)) ||
    (p["Tools"] && p["Tools"].toLowerCase().includes(query))
  );
  displayProfiles(filtered.length ? filtered : [], query);
}

function showAll() {
  displayProfiles(profiles);
}

function displayProfiles(list, query = "") {
  const results = document.getElementById("results");
  results.innerHTML = "";
  if (!list.length) {
    results.innerHTML = `<p>No match found for "${query}".</p>`;
    return;
  }

  list.forEach(p => {
    const div = document.createElement("div");
    div.className = "profile";

    // Profile Video clickable
    let videoButton = "";
    if(p["Profile Video"]) {
      videoButton = `<a href="${p["Profile Video"]}" target="_blank">View Profile Video</a>`;
    }

    // Write-up logic
    let writeUpLink = "";
    if(p["Status"] && p["Status"].toLowerCase() === "available") {
      writeUpLink = `<a href="https://docs.google.com/forms/d/e/1FAIpQLSc86QPxHxWImOEy0vR7i7WJyNsYYs-8Wk5khc3Th_YsxSHXZw/viewform" target="_blank">Request Write-Up</a>`;
    } else {
      writeUpLink = `<a href="mailto:OBPHTraining@officebeacon.com,hazel.guevarra@officebeacon.com">Email Training Team</a> <span class="disabled">Request Write-Up</span>`;
    }

    div.innerHTML = `
      <img src="${p["Photo URL"] || "https://via.placeholder.com/100"}" alt="${p["Name"]}">
      <div class="profile-details">
        <h3>${p["Name"] || "Unnamed"}</h3>
        <p><b>Role:</b> ${p["Role"] || ""}</p>
        <p><b>Status:</b> ${p["Status"] || ""}</p>
        <p><b>Skills:</b> ${p["Skills"] || ""}</p>
        <p><b>Tools:</b> ${p["Tools"] || ""}</p>
        <p><b>Experience:</b> ${p["Experience"] || ""}</p>
        <p><a href="${p["Courses"]}" target="_blank">Courses</a></p>
        <div class="actions">
          ${videoButton} ${writeUpLink}
        </div>
      </div>
    `;
    results.appendChild(div);
  });
}

fetchProfiles();
</script>
</body>
</html>
